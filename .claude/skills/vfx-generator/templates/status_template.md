# Status Effect Template

## Pattern Description
Looping visual effect that follows a character, indicating an active status (burning, frozen, poisoned, blessed, etc.). Can deal damage over time.

## Scene Structure
```
Node2D (Root) - "[StatusName]"
├── GPUParticles2D - "Particles"
│   └── [Floating particles - up for fire/holy, down for poison]
├── ColorRect or Sprite2D - "GroundGlow"
│   └── [Pulsing glow beneath character]
├── AnimationPlayer - "PulseAnimation"
│   └── [Controls glow pulsing]
├── Timer - "DamageTick"
│   └── [For DoT effects]
└── AudioStreamPlayer2D - "LoopSound" (optional)
```

## Complete .tscn Template

```
[gd_scene load_steps=5 format=3 uid="uid://status_template"]

[ext_resource type="Script" path="res://vfx/status/SCRIPT_NAME.gd" id="1_script"]

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_status"]
emission_shape = 1
emission_sphere_radius = 8.0
particle_flag_disable_z = true
direction = Vector3(0, PARTICLE_DIRECTION, 0)
spread = 30.0
gravity = Vector3(0, GRAVITY_Y, 0)
initial_velocity_min = 20.0
initial_velocity_max = 40.0
damping_min = 0.5
damping_max = 1.0
scale_min = 0.3
scale_max = 0.8
color = Color(PRIMARY_COLOR)

[sub_resource type="Animation" id="Animation_pulse"]
resource_name = "pulse"
length = 1.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("GroundGlow:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(1, 1), Vector2(1.2, 1.2), Vector2(1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("GroundGlow:modulate:a")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.5, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [0.5, 0.7, 0.5]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_status"]
_data = {
"pulse": SubResource("Animation_pulse")
}

[node name="EFFECT_NAME" type="Node2D"]
script = ExtResource("1_script")

[node name="Particles" type="GPUParticles2D" parent="."]
position = Vector2(0, -16)
amount = 12
process_material = SubResource("ParticleProcessMaterial_status")
lifetime = 1.0

[node name="GroundGlow" type="ColorRect" parent="."]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -16.0
offset_top = 8.0
offset_right = 16.0
offset_bottom = 24.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(16, 8)
color = Color(GLOW_COLOR_WITH_ALPHA)

[node name="PulseAnimation" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_status")
}
autoplay = "pulse"

[node name="DamageTick" type="Timer" parent="."]
wait_time = 1.0
autostart = true
```

## Complete Script Template

```gdscript
## [EFFECT_NAME] - Status Effect VFX
## Generated by VFX Generator skill
## Type: Status
extends Node2D

# ===== EXPORTED PROPERTIES =====
@export var particle_color: Color = Color("PRIMARY_COLOR")
@export var glow_color: Color = Color("GLOW_COLOR")
@export var damage_per_tick: int = 2
@export var tick_interval: float = 1.0
@export var duration: float = 5.0  # 0 = infinite until removed
@export var follow_target: bool = true

# ===== NODE REFERENCES =====
@onready var particles: GPUParticles2D = $Particles
@onready var ground_glow: ColorRect = $GroundGlow
@onready var pulse_animation: AnimationPlayer = $PulseAnimation
@onready var damage_tick: Timer = $DamageTick

# ===== INTERNAL STATE =====
var target: Node2D = null
var _elapsed: float = 0.0

# ===== LIFECYCLE =====
func _ready() -> void:
	_apply_colors()
	_setup_timers()

	# Start sound if available
	if has_node("LoopSound"):
		$LoopSound.play()

func _apply_colors() -> void:
	# Apply particle color
	var particle_mat = particles.process_material as ParticleProcessMaterial
	if particle_mat:
		particle_mat.color = particle_color

	# Apply glow color
	ground_glow.color = glow_color

func _setup_timers() -> void:
	damage_tick.wait_time = tick_interval
	damage_tick.timeout.connect(_on_damage_tick)

	# Duration timer (if not infinite)
	if duration > 0:
		get_tree().create_timer(duration).timeout.connect(remove_status)

func _process(_delta: float) -> void:
	# Follow target if set
	if follow_target and target and is_instance_valid(target):
		global_position = target.global_position

# ===== DAMAGE =====
func _on_damage_tick() -> void:
	if target and is_instance_valid(target) and target.has_method("take_damage"):
		target.take_damage(damage_per_tick, "ELEMENT_TYPE")
		_spawn_damage_number()

func _spawn_damage_number() -> void:
	var dmg_num_scene = load("res://vfx/ui/damage_number.tscn")
	if dmg_num_scene:
		var dmg_num = dmg_num_scene.instantiate()
		get_tree().current_scene.add_child(dmg_num)
		dmg_num.global_position = global_position + Vector2(0, -30)
		if dmg_num.has_method("set_number"):
			dmg_num.set_number(damage_per_tick, particle_color)

# ===== PUBLIC API =====
func attach_to(character: Node2D) -> void:
	## Attach this status effect to a character
	target = character

	if follow_target:
		# Reparent to character for automatic following
		var current_parent = get_parent()
		if current_parent:
			current_parent.remove_child(self)
		character.add_child(self)
		position = Vector2.ZERO
	else:
		global_position = character.global_position

func remove_status() -> void:
	## Remove this status effect with fade out
	# Stop damage
	damage_tick.stop()

	# Stop particles
	particles.emitting = false

	# Fade out glow
	var tween = create_tween()
	tween.tween_property(ground_glow, "modulate:a", 0.0, 0.3)

	# Destroy after fade
	await tween.finished
	queue_free()

func refresh_duration() -> void:
	## Reset the duration timer (for stacking/refreshing)
	if duration > 0:
		_elapsed = 0.0
		# Note: Would need to track timer differently for true refresh
```

## Usage Example

```gdscript
# Apply a status effect to a character
func apply_status(character: Node2D) -> void:
	var status = preload("res://vfx/status/EFFECT_NAME.tscn").instantiate()
	get_tree().current_scene.add_child(status)
	status.attach_to(character)

# Apply with custom settings
func apply_strong_burn(character: Node2D) -> void:
	var status = preload("res://vfx/status/burning.tscn").instantiate()
	get_tree().current_scene.add_child(status)
	status.damage_per_tick = 5
	status.duration = 10.0
	status.attach_to(character)

# Remove status early
func cleanse_status(character: Node2D, status_name: String) -> void:
	for child in character.get_children():
		if child.name == status_name and child.has_method("remove_status"):
			child.remove_status()
```

## Variants

### Buff Status (No Damage, Visual Only)
```gdscript
# Remove damage tick connection
func _setup_timers() -> void:
	damage_tick.stop()  # Don't deal damage

	if duration > 0:
		get_tree().create_timer(duration).timeout.connect(remove_status)
```

### Stacking Status
```gdscript
@export var max_stacks: int = 5
var current_stacks: int = 1

func add_stack() -> void:
	if current_stacks < max_stacks:
		current_stacks += 1
		# Increase visual intensity
		particles.amount = 12 + (current_stacks * 4)
		ground_glow.scale = Vector2(1.0 + current_stacks * 0.1, 1.0 + current_stacks * 0.1)

func _on_damage_tick() -> void:
	var total_damage = damage_per_tick * current_stacks
	if target and is_instance_valid(target) and target.has_method("take_damage"):
		target.take_damage(total_damage, "ELEMENT_TYPE")
```

### Movement Modifier Status (Slow/Speed)
```gdscript
@export var speed_modifier: float = 0.5  # 0.5 = 50% slow

func attach_to(character: Node2D) -> void:
	target = character
	# Apply speed modification
	if character.has_method("modify_speed"):
		character.modify_speed(speed_modifier)
	# ... rest of attach logic

func remove_status() -> void:
	# Restore speed
	if target and is_instance_valid(target) and target.has_method("modify_speed"):
		target.modify_speed(1.0 / speed_modifier)  # Restore
	# ... rest of remove logic
```

## Element-Specific Configurations

### Burning
```
Particles:
- Direction: Up (-1)
- Gravity: -30 (floats up)
- Color: Orange-red
- Amount: 12

Glow:
- Color: Red (#ff4136) with alpha 0.5
- Position: Below character (y = 8)
```

### Frozen
```
Particles:
- Direction: Down (1) or random
- Gravity: 10 (slight fall)
- Color: Cyan-white
- Amount: 8

Glow:
- Color: Blue (#3b82f6) with alpha 0.6
- Consider: Blue tint shader on character sprite
```

### Poisoned
```
Particles:
- Direction: Down (1)
- Gravity: 20 (drips down)
- Color: Green
- Amount: 10

Glow:
- Color: Green (#22c55e) with alpha 0.4
```

### Blessed/Healing
```
Particles:
- Direction: Up (-1)
- Gravity: -50 (floats up fast)
- Color: Gold-white
- Amount: 15

Glow:
- Color: Gold (#fbbf24) with alpha 0.5
- Damage: 0 (or negative for heal)
```

## Element Color Presets

| Status | Particle Color | Glow Color | Direction |
|--------|----------------|------------|-----------|
| Burning | `#ff6b35` | `#ff413680` | Up (-1) |
| Frozen | `#06b6d4` | `#3b82f699` | Down (1) |
| Poisoned | `#22c55e` | `#84cc1666` | Down (1) |
| Shocked | `#38bdf8` | `#f0f9ff80` | Random |
| Blessed | `#fbbf24` | `#fcd34d80` | Up (-1) |
| Cursed | `#7c3aed` | `#1e1b4b99` | Down (1) |
| Bleeding | `#dc2626` | `#b91c1c80` | Down (1) |
