# Complete Example: Healing Circle AOE

A green/gold healing circle that expands, pulses, and heals allies within its area.

## File 1: res://vfx/aoe/healing_circle.tscn

```
[gd_scene load_steps=6 format=3 uid="uid://healing_circle"]

[ext_resource type="Script" path="res://vfx/aoe/healing_circle.gd" id="1_script"]

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_sparkles"]
emission_shape = 6
emission_ring_radius = 56.0
emission_ring_inner_radius = 48.0
emission_ring_height = 2.0
particle_flag_disable_z = true
direction = Vector3(0, -1, 0)
spread = 20.0
gravity = Vector3(0, -60, 0)
initial_velocity_min = 30.0
initial_velocity_max = 50.0
damping_min = 0.5
damping_max = 1.0
scale_min = 0.2
scale_max = 0.6
color = Color(0.98, 0.75, 0.15, 1)

[sub_resource type="Shader" id="Shader_heal_circle"]
code = "shader_type canvas_item;

uniform float pulse_speed = 2.5;
uniform vec4 inner_color : source_color = vec4(0.13, 0.77, 0.37, 0.7);
uniform vec4 outer_color : source_color = vec4(0.98, 0.75, 0.15, 0.5);

void fragment() {
	vec2 uv = UV - vec2(0.5);
	float dist = length(uv);

	float pulse = sin(TIME * pulse_speed) * 0.15 + 0.7;

	// Soft circle with gradient
	float circle = 1.0 - smoothstep(0.3, 0.5, dist);

	// Inner bright ring
	float ring = smoothstep(0.25, 0.3, dist) * (1.0 - smoothstep(0.35, 0.45, dist));

	// Blend colors
	vec4 color = mix(inner_color, outer_color, dist * 2.0);
	float alpha = (circle * 0.5 + ring * 0.5) * pulse;

	COLOR = vec4(color.rgb, alpha * color.a);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_heal"]
shader = SubResource("Shader_heal_circle")
shader_parameter/pulse_speed = 2.5
shader_parameter/inner_color = Color(0.13, 0.77, 0.37, 0.7)
shader_parameter/outer_color = Color(0.98, 0.75, 0.15, 0.5)

[sub_resource type="CircleShape2D" id="CircleShape2D_area"]
radius = 64.0

[node name="HealingCircle" type="Area2D"]
collision_layer = 0
collision_mask = 3
script = ExtResource("1_script")

[node name="CircleVisual" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_heal")
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -64.0
offset_top = -64.0
offset_right = 64.0
offset_bottom = 64.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(64, 64)

[node name="Sparkles" type="GPUParticles2D" parent="."]
amount = 25
process_material = SubResource("ParticleProcessMaterial_sparkles")
lifetime = 1.2

[node name="HitArea" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_area")

[node name="Glow" type="PointLight2D" parent="."]
color = Color(0.13, 0.77, 0.37, 1)
energy = 0.8
texture_scale = 4.0

[node name="HealTick" type="Timer" parent="."]
wait_time = 0.5
autostart = true
```

## File 2: res://vfx/aoe/healing_circle.gd

```gdscript
## Healing Circle - AOE heal effect
## Generated by VFX Generator skill
extends Area2D

# ===== EXPORTED PROPERTIES =====
@export var heal_per_tick: int = 8
@export var tick_interval: float = 0.5
@export var total_duration: float = 4.0
@export var expand_duration: float = 0.4

# ===== INTERNAL =====
var _caster_group: String = "ally"  # Only heal allies

# ===== NODE REFERENCES =====
@onready var circle_visual: ColorRect = $CircleVisual
@onready var sparkles: GPUParticles2D = $Sparkles
@onready var hit_area: CollisionShape2D = $HitArea
@onready var glow: PointLight2D = $Glow
@onready var heal_tick: Timer = $HealTick

func _ready() -> void:
	heal_tick.wait_time = tick_interval
	heal_tick.timeout.connect(_on_heal_tick)

	_play_expand_animation()

	get_tree().create_timer(total_duration).timeout.connect(_on_duration_complete)

func _play_expand_animation() -> void:
	# Start small
	circle_visual.scale = Vector2(0.1, 0.1)
	glow.texture_scale = 0.4

	var tween = create_tween()
	tween.set_parallel(true)

	# Expand visual
	tween.tween_property(circle_visual, "scale", Vector2(1.0, 1.0), expand_duration)
	tween.set_ease(Tween.EASE_OUT)
	tween.set_trans(Tween.TRANS_BACK)

	# Expand glow
	tween.tween_property(glow, "texture_scale", 4.0, expand_duration)

	# Expand collision
	var shape = hit_area.shape as CircleShape2D
	if shape:
		var target_radius = shape.radius
		shape.radius = target_radius * 0.1
		tween.tween_property(shape, "radius", target_radius, expand_duration)

func _on_heal_tick() -> void:
	var bodies = get_overlapping_bodies()
	var areas = get_overlapping_areas()

	# Heal bodies in area
	for body in bodies:
		if body.is_in_group(_caster_group) and body.has_method("heal"):
			body.heal(heal_per_tick)
			_spawn_heal_number(body)

	# Check area parents too
	for area in areas:
		var parent = area.get_parent()
		if parent and parent.is_in_group(_caster_group) and parent.has_method("heal"):
			parent.heal(heal_per_tick)
			_spawn_heal_number(parent)

func _spawn_heal_number(target: Node2D) -> void:
	var heal_num_scene = load("res://vfx/ui/heal_number.tscn")
	if heal_num_scene:
		var heal_num = heal_num_scene.instantiate()
		get_tree().current_scene.add_child(heal_num)
		heal_num.global_position = target.global_position + Vector2(0, -30)
		if heal_num.has_method("set_heal"):
			heal_num.set_heal(heal_per_tick)
		elif heal_num.has_method("set_number"):
			heal_num.set_number(heal_per_tick, Color.GREEN)

func _on_duration_complete() -> void:
	heal_tick.stop()
	sparkles.emitting = false

	var tween = create_tween()
	tween.set_parallel(true)
	tween.tween_property(circle_visual, "modulate:a", 0.0, 0.4)
	tween.tween_property(glow, "energy", 0.0, 0.4)

	await tween.finished
	queue_free()

# ===== PUBLIC API =====
func set_caster_group(group_name: String) -> void:
	## Set which group to heal (e.g., "ally" or "enemy")
	_caster_group = group_name
```

## File 3: res://vfx/ui/heal_number.tscn

```
[gd_scene load_steps=3 format=3 uid="uid://heal_number"]

[ext_resource type="Script" path="res://vfx/ui/heal_number.gd" id="1_script"]

[sub_resource type="LabelSettings" id="LabelSettings_heal"]
font_size = 18
font_color = Color(0.13, 0.77, 0.37, 1)
outline_size = 2
outline_color = Color(0, 0, 0, 1)

[node name="HealNumber" type="Label"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -40.0
offset_top = -12.0
offset_right = 40.0
offset_bottom = 12.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(40, 12)
text = "+10"
label_settings = SubResource("LabelSettings_heal")
horizontal_alignment = 1
vertical_alignment = 1
script = ExtResource("1_script")
```

## File 4: res://vfx/ui/heal_number.gd

```gdscript
## Heal Number - Floating heal indicator
## Generated by VFX Generator skill
extends Label

@export var float_distance: float = 40.0
@export var float_duration: float = 0.9
@export var horizontal_spread: float = 15.0

func _ready() -> void:
	position.x += randf_range(-horizontal_spread, horizontal_spread)
	_play_animation()

func _play_animation() -> void:
	var tween = create_tween()
	tween.set_parallel(true)

	# Float up
	tween.tween_property(self, "position:y", position.y - float_distance, float_duration)

	# Scale pop
	tween.tween_property(self, "scale", Vector2(1.2, 1.2), 0.1)
	tween.chain().tween_property(self, "scale", Vector2(0.9, 0.9), float_duration - 0.1)

	# Fade out
	tween.tween_property(self, "modulate:a", 0.0, float_duration * 0.5).set_delay(float_duration * 0.5)

	await tween.finished
	queue_free()

func set_heal(value: int) -> void:
	text = "+" + str(value)
	modulate = Color.GREEN

func set_number(value: int, color: Color = Color.GREEN) -> void:
	text = "+" + str(value)
	modulate = color
```

## Usage Example

```gdscript
# Cast healing circle at position
func cast_healing_circle(at_position: Vector2) -> void:
	var circle = preload("res://vfx/aoe/healing_circle.tscn").instantiate()
	get_tree().current_scene.add_child(circle)
	circle.global_position = at_position

# Cast with custom settings
func cast_big_heal(at_position: Vector2) -> void:
	var circle = preload("res://vfx/aoe/healing_circle.tscn").instantiate()
	get_tree().current_scene.add_child(circle)
	circle.global_position = at_position
	circle.heal_per_tick = 15
	circle.total_duration = 6.0
	circle.scale = Vector2(1.5, 1.5)

# Cast on self
func cast_self_heal(caster: Node2D) -> void:
	var circle = preload("res://vfx/aoe/healing_circle.tscn").instantiate()
	get_tree().current_scene.add_child(circle)
	circle.global_position = caster.global_position
```

## Testing

```gdscript
# Test scene script
extends Node2D

func _input(event: InputEvent) -> void:
	if event is InputEventMouseButton and event.pressed:
		if event.button_index == MOUSE_BUTTON_LEFT:
			# Spawn healing circle at click position
			var circle = preload("res://vfx/aoe/healing_circle.tscn").instantiate()
			add_child(circle)
			circle.position = get_local_mouse_position()
```

Run the scene and click to spawn healing circles. They'll expand, pulse, and fade out after 4 seconds.
