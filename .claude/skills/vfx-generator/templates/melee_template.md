# Melee/Slash Template

## Pattern Description
Quick arc or slash visual for melee weapon attacks. Includes slash trail, impact sparks, and auto-destroys.

## Scene Structure
```
Node2D (Root) - "[MeleeName]"
├── Line2D - "SlashArc"
│   └── [Arc shape that rotates/fades]
├── GPUParticles2D - "Sparks"
│   └── [Small burst of impact sparks]
├── ColorRect - "Flash" (optional)
│   └── [Brief white flash at impact point]
└── AudioStreamPlayer2D - "SlashSound" (optional)
```

## Complete .tscn Template

```
[gd_scene load_steps=4 format=3 uid="uid://melee_template"]

[ext_resource type="Script" path="res://vfx/melee/SCRIPT_NAME.gd" id="1_script"]

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_sparks"]
emission_shape = 0
particle_flag_disable_z = true
direction = Vector3(1, -1, 0)
spread = 45.0
gravity = Vector3(0, 200, 0)
initial_velocity_min = 80.0
initial_velocity_max = 150.0
damping_min = 2.0
damping_max = 4.0
scale_min = 0.3
scale_max = 0.8
color = Color(SPARK_COLOR)

[sub_resource type="Curve" id="Curve_width"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.3, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="Gradient" id="Gradient_color"]
offsets = PackedFloat32Array(0, 0.5, 1)
colors = PackedColorArray(1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0)

[node name="EFFECT_NAME" type="Node2D"]
script = ExtResource("1_script")

[node name="SlashArc" type="Line2D" parent="."]
width = 6.0
width_curve = SubResource("Curve_width")
default_color = Color(LINE_COLOR)
gradient = SubResource("Gradient_color")
begin_cap_mode = 2
end_cap_mode = 2
antialiased = true

[node name="Sparks" type="GPUParticles2D" parent="."]
amount = 10
process_material = SubResource("ParticleProcessMaterial_sparks")
lifetime = 0.3
one_shot = true
explosiveness = 1.0

[node name="Flash" type="ColorRect" parent="."]
visible = false
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -8.0
offset_top = -8.0
offset_right = 8.0
offset_bottom = 8.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(8, 8)
color = Color(1, 1, 1, 1)
```

## Complete Script Template

```gdscript
## [EFFECT_NAME] - Melee/Slash VFX
## Generated by VFX Generator skill
## Type: Melee
extends Node2D

# ===== EXPORTED PROPERTIES =====
@export var arc_radius: float = 40.0
@export var arc_angle: float = PI / 2  # 90 degrees
@export var arc_segments: int = 12
@export var line_color: Color = Color.WHITE
@export var line_width: float = 6.0
@export var spark_color: Color = Color("SPARK_COLOR")
@export var duration: float = 0.2
@export var start_angle: float = -PI / 4  # -45 degrees
@export var sweep_direction: int = 1  # 1 = clockwise, -1 = counter-clockwise

# ===== NODE REFERENCES =====
@onready var slash_arc: Line2D = $SlashArc
@onready var sparks: GPUParticles2D = $Sparks
@onready var flash: ColorRect = $Flash if has_node("Flash") else null

# ===== LIFECYCLE =====
func _ready() -> void:
	_apply_colors()
	_create_arc()
	_play_animation()

	# Play sound if available
	if has_node("SlashSound"):
		$SlashSound.play()

func _apply_colors() -> void:
	slash_arc.default_color = line_color
	slash_arc.width = line_width

	var spark_mat = sparks.process_material as ParticleProcessMaterial
	if spark_mat:
		spark_mat.color = spark_color

func _create_arc() -> void:
	## Generate arc points
	var points: PackedVector2Array = []

	for i in range(arc_segments + 1):
		var t = float(i) / arc_segments
		var angle = start_angle + (arc_angle * t * sweep_direction)
		var point = Vector2(cos(angle), sin(angle)) * arc_radius
		points.append(point)

	slash_arc.points = points

func _play_animation() -> void:
	# Start with arc hidden
	slash_arc.modulate.a = 0.0

	var tween = create_tween()

	# Quick fade in
	tween.tween_property(slash_arc, "modulate:a", 1.0, duration * 0.2)

	# Rotate the slash
	tween.parallel().tween_property(self, "rotation", rotation + (arc_angle * sweep_direction * 0.5), duration)

	# Scale up slightly
	tween.parallel().tween_property(slash_arc, "scale", Vector2(1.1, 1.1), duration * 0.5)

	# Fade out in second half
	tween.tween_property(slash_arc, "modulate:a", 0.0, duration * 0.3)

	# Trigger sparks at midpoint
	await get_tree().create_timer(duration * 0.4).timeout
	sparks.emitting = true

	# Flash effect
	if flash:
		flash.visible = true
		flash.modulate.a = 1.0
		var flash_tween = create_tween()
		flash_tween.tween_property(flash, "modulate:a", 0.0, 0.1)
		flash_tween.tween_property(flash, "scale", Vector2(2.0, 2.0), 0.1)

	# Auto-destroy
	await get_tree().create_timer(duration + 0.2).timeout
	queue_free()

# ===== PUBLIC API =====
func set_facing(facing_right: bool) -> void:
	## Flip the slash based on character facing direction
	if not facing_right:
		scale.x = -1

func set_attack_direction(dir: Vector2) -> void:
	## Point the slash in a specific direction
	rotation = dir.angle()
```

## Usage Example

```gdscript
# Spawn a melee slash effect
func play_attack_effect(attacker: Node2D, facing_right: bool) -> void:
	var slash = preload("res://vfx/melee/EFFECT_NAME.tscn").instantiate()
	get_tree().current_scene.add_child(slash)

	# Position at attacker
	slash.global_position = attacker.global_position + Vector2(20 if facing_right else -20, -10)
	slash.set_facing(facing_right)

# Directional attack
func play_directional_attack(from_pos: Vector2, to_pos: Vector2) -> void:
	var slash = preload("res://vfx/melee/EFFECT_NAME.tscn").instantiate()
	get_tree().current_scene.add_child(slash)

	slash.global_position = from_pos
	slash.set_attack_direction(to_pos - from_pos)
```

## Variants

### Overhead Chop (Vertical Arc)
```gdscript
func _ready() -> void:
	start_angle = -PI / 2  # Start at top
	arc_angle = PI  # 180 degree sweep
	# ... rest of setup
```

### Stab/Thrust (Line, Not Arc)
```gdscript
func _create_arc() -> void:
	# Just a straight line instead of arc
	var points: PackedVector2Array = [
		Vector2.ZERO,
		Vector2(arc_radius, 0)
	]
	slash_arc.points = points

func _play_animation() -> void:
	# Scale forward instead of rotate
	slash_arc.scale = Vector2(0.1, 1.0)

	var tween = create_tween()
	tween.tween_property(slash_arc, "scale", Vector2(1.0, 1.0), duration * 0.3)
	tween.tween_property(slash_arc, "modulate:a", 0.0, duration * 0.7)

	# ... rest of animation
```

### Spin Attack (Full Circle)
```gdscript
func _ready() -> void:
	arc_angle = TAU  # Full 360 degrees
	arc_segments = 24  # More segments for smooth circle

	_apply_colors()
	_create_arc()
	_play_spin_animation()

func _play_spin_animation() -> void:
	var tween = create_tween()
	tween.tween_property(self, "rotation", TAU, duration)
	tween.parallel().tween_property(slash_arc, "modulate:a", 0.0, duration)
```

### Multi-Hit Combo
```gdscript
static func spawn_combo(at_position: Vector2, hit_count: int) -> void:
	for i in range(hit_count):
		await get_tree().create_timer(0.1).timeout

		var slash = preload("res://vfx/melee/sword_slash.tscn").instantiate()
		get_tree().current_scene.add_child(slash)
		slash.global_position = at_position + Vector2(randf_range(-10, 10), randf_range(-10, 10))
		slash.rotation = randf_range(-PI/4, PI/4)
```

### Procedural Lightning Slash (Zigzag)
```gdscript
func _create_arc() -> void:
	var points: PackedVector2Array = []
	var segments = 8

	for i in range(segments + 1):
		var t = float(i) / segments
		var base_point = Vector2(t * arc_radius, 0)
		# Add random offset for zigzag
		var offset = Vector2(0, randf_range(-8, 8)) if i > 0 and i < segments else Vector2.ZERO
		points.append(base_point + offset)

	slash_arc.points = points
	slash_arc.default_color = Color.CYAN
```

## Weapon Type Presets

### Sword Slash
```
arc_radius: 40
arc_angle: PI/2 (90 degrees)
line_width: 6
line_color: White
spark_color: Yellow-white
```

### Axe Chop
```
arc_radius: 35
arc_angle: PI/3 (60 degrees)
line_width: 8
line_color: Light gray
spark_color: Orange-red
```

### Dagger Stab
```
arc_radius: 25
arc_angle: 0 (straight line)
line_width: 3
line_color: White
spark_color: White
```

### Hammer Smash
```
arc_radius: 50
arc_angle: PI/4 (45 degrees)
line_width: 10
line_color: Gray
spark_color: Yellow
Additional: Larger screen shake
```

### Spear Thrust
```
arc_radius: 60
arc_angle: 0 (straight line)
line_width: 4
line_color: Silver
spark_color: White
```

## Color Presets by Attack Element

| Element | Line Color | Spark Color |
|---------|------------|-------------|
| Physical | `#ffffff` | `#fef08a` |
| Fire | `#ff6b35` | `#ffdc00` |
| Ice | `#3b82f6` | `#e0f2fe` |
| Lightning | `#38bdf8` | `#ffffff` |
| Poison | `#22c55e` | `#84cc16` |
| Holy | `#fbbf24` | `#ffffff` |
| Dark | `#7c3aed` | `#a78bfa` |
