# Projectile Template

## Pattern Description
Moving object that travels in a direction and spawns an impact effect on collision or max distance.

## Scene Structure
```
Node2D (Root) - "[ProjectileName]"
├── ColorRect or Polygon2D - "Visual"
│   └── [Procedural shape - square, triangle, or circle]
├── GPUParticles2D - "Trail"
│   └── [Particle system for trail effect]
├── PointLight2D - "Glow" (optional)
│   └── [Adds glow around projectile]
├── Area2D - "Hitbox"
│   └── CollisionShape2D
│       └── [Circle or capsule shape]
└── AudioStreamPlayer2D - "LaunchSound" (optional)
```

## Complete .tscn Template

Uses **layered circles** (Polygon2D) for a round, organic visual with animated pulsing.

```
[gd_scene load_steps=4 format=3 uid="uid://projectile_template"]

[ext_resource type="Script" path="res://vfx/projectiles/SCRIPT_NAME.gd" id="1_script"]

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_trail"]
emission_shape = 0
particle_flag_disable_z = true
direction = Vector3(-1, 0, 0)
spread = 25.0
gravity = Vector3(0, 0, 0)
initial_velocity_min = 80.0
initial_velocity_max = 120.0
damping_min = 1.0
damping_max = 2.0
scale_min = 0.3
scale_max = 0.8
color = Color(SECONDARY_COLOR)

[sub_resource type="CircleShape2D" id="CircleShape2D_hitbox"]
radius = 12.0

[node name="EFFECT_NAME" type="Node2D" groups=["projectile"]]
script = ExtResource("1_script")

# Visual container for animation
[node name="Visual" type="Node2D" parent="."]

# Layered circles: outer (large, transparent), mid (medium), core (small, bright)
[node name="OuterGlow" type="Polygon2D" parent="Visual"]
color = Color(OUTER_COLOR, 0.4)
polygon = PackedVector2Array(-18, 0, -15.6, -9, -9, -15.6, 0, -18, 9, -15.6, 15.6, -9, 18, 0, 15.6, 9, 9, 15.6, 0, 18, -9, 15.6, -15.6, 9)

[node name="MidGlow" type="Polygon2D" parent="Visual"]
color = Color(PRIMARY_COLOR, 0.7)
polygon = PackedVector2Array(-12, 0, -10.4, -6, -6, -10.4, 0, -12, 6, -10.4, 10.4, -6, 12, 0, 10.4, 6, 6, 10.4, 0, 12, -6, 10.4, -10.4, 6)

[node name="Core" type="Polygon2D" parent="Visual"]
color = Color(ACCENT_COLOR)
polygon = PackedVector2Array(-6, 0, -5.2, -3, -3, -5.2, 0, -6, 3, -5.2, 5.2, -3, 6, 0, 5.2, 3, 3, 5.2, 0, 6, -3, 5.2, -5.2, 3)

[node name="Trail" type="GPUParticles2D" parent="."]
amount = 25
process_material = SubResource("ParticleProcessMaterial_trail")
lifetime = 0.4
local_coords = false

[node name="Glow" type="PointLight2D" parent="."]
color = Color(GLOW_COLOR)
energy = 1.8
texture_scale = 2.0

[node name="Hitbox" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Hitbox"]
shape = SubResource("CircleShape2D_hitbox")
```

## Complete Script Template

```gdscript
## [EFFECT_NAME] - Projectile VFX
## Generated by VFX Generator skill
## Type: Projectile
extends Node2D

# ===== EXPORTED PROPERTIES =====
@export var speed: float = 500.0
@export var direction: Vector2 = Vector2.RIGHT
@export var max_distance: float = 1000.0
@export var pierce_count: int = 0  # 0 = destroy on first hit
@export var impact_effect: PackedScene

# ===== ANIMATION CONSTANTS =====
const PULSE_SPEED: float = 8.0       # How fast it pulses
const PULSE_AMOUNT: float = 0.15     # Scale variation (0.15 = +/-15%)
const WOBBLE_SPEED: float = 12.0     # How fast layers wobble
const WOBBLE_AMOUNT: float = 0.08    # Wobble intensity

# ===== INTERNAL STATE =====
var _traveled: float = 0.0
var _pierced: int = 0
var _time: float = 0.0

# ===== NODE REFERENCES =====
@onready var visual: Node2D = $Visual
@onready var outer_glow: Polygon2D = $Visual/OuterGlow
@onready var mid_glow: Polygon2D = $Visual/MidGlow
@onready var core: Polygon2D = $Visual/Core
@onready var trail: GPUParticles2D = $Trail
@onready var glow: PointLight2D = $Glow if has_node("Glow") else null
@onready var hitbox: Area2D = $Hitbox

# ===== LIFECYCLE =====
func _ready() -> void:
	_connect_signals()

	# Play launch sound if available
	if has_node("LaunchSound"):
		$LaunchSound.play()

func _connect_signals() -> void:
	hitbox.area_entered.connect(_on_hit)
	hitbox.body_entered.connect(_on_hit)

func _process(delta: float) -> void:
	_time += delta

	# Move forward
	var movement = direction.normalized() * speed * delta
	position += movement
	_traveled += movement.length()

	# Face direction of travel
	rotation = direction.angle()

	# Animate visual for organic feel
	_animate_visual()

	# Max distance check
	if _traveled >= max_distance:
		_spawn_impact()
		queue_free()

func _animate_visual() -> void:
	# Pulse scale for breathing effect
	var pulse = 1.0 + sin(_time * PULSE_SPEED) * PULSE_AMOUNT
	visual.scale = Vector2(pulse, pulse)

	# Wobble layers independently for organic feel
	var wobble1 = sin(_time * WOBBLE_SPEED) * WOBBLE_AMOUNT
	var wobble2 = cos(_time * WOBBLE_SPEED * 1.3) * WOBBLE_AMOUNT
	outer_glow.scale = Vector2(1.0 + wobble1, 1.0 - wobble1)
	mid_glow.scale = Vector2(1.0 - wobble2, 1.0 + wobble2)

	# Flicker the glow energy
	if glow:
		glow.energy = 1.5 + sin(_time * PULSE_SPEED * 2.0) * 0.4

# ===== COLLISION =====
func _on_hit(body: Node2D) -> void:
	# Ignore certain groups if needed
	if body.is_in_group("projectile"):
		return

	_pierced += 1

	if _pierced > pierce_count:
		_spawn_impact()
		queue_free()

func _spawn_impact() -> void:
	if impact_effect:
		var impact = impact_effect.instantiate()
		get_parent().add_child(impact)
		impact.global_position = global_position
		impact.rotation = direction.angle()

# ===== PUBLIC API =====
func set_direction(dir: Vector2) -> void:
	direction = dir.normalized()

func set_target(target_pos: Vector2) -> void:
	direction = (target_pos - global_position).normalized()
```

## Usage Example

```gdscript
# Spawn a projectile
func cast_projectile(from_pos: Vector2, target_pos: Vector2) -> void:
	var projectile = preload("res://vfx/projectiles/EFFECT_NAME.tscn").instantiate()
	get_tree().current_scene.add_child(projectile)

	projectile.global_position = from_pos
	projectile.set_target(target_pos)
	projectile.speed = 500
	projectile.impact_effect = preload("res://vfx/impacts/IMPACT_NAME.tscn")
```

## Variants

### Homing Projectile
Add to script:
```gdscript
@export var homing_strength: float = 2.0
var target: Node2D

func _process(delta: float) -> void:
	if target and is_instance_valid(target):
		var target_dir = (target.global_position - global_position).normalized()
		direction = direction.lerp(target_dir, homing_strength * delta).normalized()

	# ... rest of movement code
```

### Splitting Projectile
```gdscript
@export var split_count: int = 3
@export var split_projectile: PackedScene

func _spawn_impact() -> void:
	# Spawn regular impact
	if impact_effect:
		var impact = impact_effect.instantiate()
		get_parent().add_child(impact)
		impact.global_position = global_position

	# Spawn split projectiles
	if split_projectile:
		for i in range(split_count):
			var angle = (TAU / split_count) * i
			var split = split_projectile.instantiate()
			get_parent().add_child(split)
			split.global_position = global_position
			split.direction = Vector2.RIGHT.rotated(angle + rotation)
```

### Different Visual Shapes

**Triangle/Shard (Polygon2D):**
```gdscript
# Replace ColorRect with Polygon2D in scene
# Set points to triangle:
# [Vector2(12, 0), Vector2(-6, 6), Vector2(-6, -6)]
```

**Circle (procedural texture):**
```gdscript
func _create_circle_visual() -> void:
	var img = Image.create(16, 16, false, Image.FORMAT_RGBA8)
	for x in range(16):
		for y in range(16):
			var dist = Vector2(x - 8, y - 8).length()
			if dist < 8:
				var alpha = 1.0 - (dist / 8.0) * 0.5
				img.set_pixel(x, y, Color(projectile_color.r, projectile_color.g, projectile_color.b, alpha))

	var texture = ImageTexture.create_from_image(img)
	var sprite = Sprite2D.new()
	sprite.texture = texture
	add_child(sprite)
```

## Element Color Presets

| Element | Primary | Secondary | Glow |
|---------|---------|-----------|------|
| Fire | `#ff6b35` | `#ff4136` | `#ff8c42` |
| Ice | `#3b82f6` | `#06b6d4` | `#60a5fa` |
| Poison | `#22c55e` | `#84cc16` | `#4ade80` |
| Lightning | `#f0f9ff` | `#38bdf8` | `#7dd3fc` |
| Holy | `#fbbf24` | `#fef3c7` | `#fcd34d` |
| Dark | `#7c3aed` | `#1e1b4b` | `#a78bfa` |
| Physical | `#d4d4d4` | `#a3a3a3` | `#e5e5e5` |
