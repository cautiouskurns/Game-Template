# AOE (Area of Effect) Template

## Pattern Description
Expanding circle effect that covers a ground area, deals damage over time, and fades out.

## Scene Structure
```
Area2D (Root) - "[AOEName]"
├── ColorRect or Sprite2D - "CircleVisual"
│   └── [Expanding circle with pulsing alpha]
├── GPUParticles2D - "GroundParticles"
│   └── [Ring emission pattern]
├── CollisionShape2D - "HitArea"
│   └── [CircleShape2D that expands with visual]
├── PointLight2D - "Glow" (optional)
├── Timer - "DamageTick"
└── AudioStreamPlayer2D - "LoopSound" (optional)
```

## Complete .tscn Template

```
[gd_scene load_steps=5 format=3 uid="uid://aoe_template"]

[ext_resource type="Script" path="res://vfx/aoe/SCRIPT_NAME.gd" id="1_script"]

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_ground"]
emission_shape = 6
emission_ring_radius = 48.0
emission_ring_inner_radius = 40.0
emission_ring_height = 2.0
particle_flag_disable_z = true
direction = Vector3(0, -1, 0)
spread = 30.0
gravity = Vector3(0, -30, 0)
initial_velocity_min = 20.0
initial_velocity_max = 40.0
damping_min = 1.0
damping_max = 2.0
scale_min = 0.3
scale_max = 0.8
color = Color(PRIMARY_COLOR)

[sub_resource type="CircleShape2D" id="CircleShape2D_hit"]
radius = 64.0

[sub_resource type="Shader" id="Shader_circle"]
code = "shader_type canvas_item;

uniform float pulse_speed = 2.0;
uniform vec4 circle_color : source_color = vec4(1.0, 0.5, 0.2, 0.6);

void fragment() {
	vec2 uv = UV - vec2(0.5);
	float dist = length(uv);

	// Pulsing alpha
	float pulse = sin(TIME * pulse_speed) * 0.2 + 0.6;

	// Circle shape with soft edge
	float circle = 1.0 - smoothstep(0.35, 0.5, dist);

	// Inner ring (brighter)
	float ring = smoothstep(0.3, 0.35, dist) * (1.0 - smoothstep(0.4, 0.5, dist));

	float alpha = (circle * 0.4 + ring * 0.6) * pulse;

	COLOR = vec4(circle_color.rgb, alpha * circle_color.a);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_circle"]
shader = SubResource("Shader_circle")
shader_parameter/pulse_speed = 2.0
shader_parameter/circle_color = Color(PRIMARY_COLOR_WITH_ALPHA)

[node name="EFFECT_NAME" type="Area2D"]
script = ExtResource("1_script")

[node name="CircleVisual" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_circle")
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -64.0
offset_top = -64.0
offset_right = 64.0
offset_bottom = 64.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(64, 64)

[node name="GroundParticles" type="GPUParticles2D" parent="."]
amount = 20
process_material = SubResource("ParticleProcessMaterial_ground")
lifetime = 1.0

[node name="HitArea" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_hit")

[node name="Glow" type="PointLight2D" parent="."]
color = Color(GLOW_COLOR)
energy = 1.0
texture_scale = 4.0

[node name="DamageTick" type="Timer" parent="."]
wait_time = 0.5
autostart = true
```

## Complete Script Template

```gdscript
## [EFFECT_NAME] - AOE VFX
## Generated by VFX Generator skill
## Type: AOE
extends Area2D

# ===== EXPORTED PROPERTIES =====
@export var start_scale: float = 0.1
@export var end_scale: float = 1.0
@export var expand_duration: float = 0.4
@export var total_duration: float = 3.0
@export var damage_per_tick: int = 5
@export var tick_interval: float = 0.5
@export var circle_color: Color = Color("PRIMARY_COLOR")
@export var particle_color: Color = Color("SECONDARY_COLOR")
@export var glow_color: Color = Color("GLOW_COLOR")

# ===== NODE REFERENCES =====
@onready var circle_visual: ColorRect = $CircleVisual
@onready var ground_particles: GPUParticles2D = $GroundParticles
@onready var hit_area: CollisionShape2D = $HitArea
@onready var glow: PointLight2D = $Glow if has_node("Glow") else null
@onready var damage_tick: Timer = $DamageTick

# ===== INTERNAL STATE =====
var _elapsed: float = 0.0

# ===== LIFECYCLE =====
func _ready() -> void:
	_apply_colors()
	_setup_timers()
	_play_expand_animation()

	# Play loop sound if available
	if has_node("LoopSound"):
		$LoopSound.play()

func _apply_colors() -> void:
	# Apply shader color
	var mat = circle_visual.material as ShaderMaterial
	if mat:
		mat.set_shader_parameter("circle_color", circle_color)

	# Apply particle color
	var particle_mat = ground_particles.process_material as ParticleProcessMaterial
	if particle_mat:
		particle_mat.color = particle_color

	# Apply glow
	if glow:
		glow.color = glow_color

func _setup_timers() -> void:
	damage_tick.wait_time = tick_interval
	damage_tick.timeout.connect(_on_damage_tick)

	# Auto-destroy timer
	get_tree().create_timer(total_duration).timeout.connect(_on_duration_complete)

func _play_expand_animation() -> void:
	# Start small
	circle_visual.scale = Vector2(start_scale, start_scale)

	# Expand to full size
	var tween = create_tween()
	tween.tween_property(circle_visual, "scale", Vector2(end_scale, end_scale), expand_duration)
	tween.set_ease(Tween.EASE_OUT)
	tween.set_trans(Tween.TRANS_BACK)

	# Scale collision to match
	var shape = hit_area.shape as CircleShape2D
	if shape:
		var start_radius = shape.radius * start_scale
		var end_radius = shape.radius * end_scale
		shape.radius = start_radius
		tween.parallel().tween_property(shape, "radius", end_radius, expand_duration)

	# Glow expands too
	if glow:
		glow.texture_scale = glow.texture_scale * start_scale
		tween.parallel().tween_property(glow, "texture_scale", glow.texture_scale / start_scale * end_scale, expand_duration)

# ===== DAMAGE =====
func _on_damage_tick() -> void:
	var bodies = get_overlapping_bodies()
	var areas = get_overlapping_areas()

	for body in bodies:
		if body.has_method("take_damage"):
			body.take_damage(damage_per_tick, "ELEMENT_TYPE")

	for area in areas:
		var parent = area.get_parent()
		if parent and parent.has_method("take_damage"):
			parent.take_damage(damage_per_tick, "ELEMENT_TYPE")

# ===== CLEANUP =====
func _on_duration_complete() -> void:
	# Fade out
	var tween = create_tween()
	tween.set_parallel(true)
	tween.tween_property(circle_visual, "modulate:a", 0.0, 0.3)
	tween.tween_property(ground_particles, "modulate:a", 0.0, 0.3)
	if glow:
		tween.tween_property(glow, "energy", 0.0, 0.3)

	# Stop damage
	damage_tick.stop()

	# Destroy after fade
	await tween.finished
	queue_free()
```

## Usage Example

```gdscript
# Spawn an AOE effect
func cast_aoe(at_position: Vector2) -> void:
	var aoe = preload("res://vfx/aoe/EFFECT_NAME.tscn").instantiate()
	get_tree().current_scene.add_child(aoe)
	aoe.global_position = at_position

# Customize the effect
func cast_big_aoe(at_position: Vector2) -> void:
	var aoe = preload("res://vfx/aoe/EFFECT_NAME.tscn").instantiate()
	get_tree().current_scene.add_child(aoe)
	aoe.global_position = at_position
	aoe.end_scale = 2.0
	aoe.total_duration = 5.0
	aoe.damage_per_tick = 10
```

## Variants

### Healing Circle (No Damage, Heals Instead)
```gdscript
@export var heal_per_tick: int = 10

func _on_damage_tick() -> void:
	var bodies = get_overlapping_bodies()
	for body in bodies:
		if body.is_in_group("ally") and body.has_method("heal"):
			body.heal(heal_per_tick)
			_spawn_heal_number(body)

func _spawn_heal_number(target: Node2D) -> void:
	var num = preload("res://vfx/ui/heal_number.tscn").instantiate()
	get_parent().add_child(num)
	num.global_position = target.global_position + Vector2(0, -30)
	num.set_number(heal_per_tick)
```

### Persistent Zone (Stays Until Removed)
```gdscript
@export var persistent: bool = true

func _ready() -> void:
	_apply_colors()
	_setup_timers()
	_play_expand_animation()

	if not persistent:
		get_tree().create_timer(total_duration).timeout.connect(_on_duration_complete)

func remove_zone() -> void:
	_on_duration_complete()
```

### Shrinking AOE (Opposite Direction)
```gdscript
func _play_expand_animation() -> void:
	# Start big
	circle_visual.scale = Vector2(end_scale, end_scale)

	# Shrink to small
	var tween = create_tween()
	tween.tween_property(circle_visual, "scale", Vector2(start_scale, start_scale), expand_duration)
```

## Simple Circle Shader (Alternative)

If shader is too complex, use simple ColorRect with modulate animation:

```gdscript
func _ready() -> void:
	# Pulse animation without shader
	var tween = create_tween()
	tween.set_loops()
	tween.tween_property(circle_visual, "modulate:a", 0.8, 0.5)
	tween.tween_property(circle_visual, "modulate:a", 0.5, 0.5)
```

## Element Color Presets

| Element | Circle Color | Particle Color | Glow |
|---------|--------------|----------------|------|
| Fire | `#ff6b35cc` | `#ff4136` | `#ff8c42` |
| Ice | `#3b82f6cc` | `#06b6d4` | `#60a5fa` |
| Poison | `#22c55ecc` | `#84cc16` | `#4ade80` |
| Lightning | `#38bdf8cc` | `#f0f9ff` | `#7dd3fc` |
| Holy | `#fbbf24cc` | `#fef3c7` | `#fcd34d` |
| Dark | `#7c3aedcc` | `#1e1b4b` | `#a78bfa` |

Note: `cc` suffix = 80% alpha for semi-transparency
